<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet" href="styling.css">
  <meta charset="UTF-8">
  <script src="d3.js"></script>
  <title>Danmarks klimamål</title>
</head>

<body>
  <div class="header">
    <h1>Danmarks Klimamål</h1>
  </div>
  
  <div class="navbar">
    <a href="#" class="active">Oversigt</a>
    <a href="mainTest.html">Klimaberegneren</a>
    <a href="#">Placeholder</a>
   </div>
  
  <div class="row">
    <div class="side">
      <h2>Historisk overblik over danmarks udledning</h2> 
      <select id="dropdown"></select>
    </div>
    
      <div class="main">
      <h2>Visualisering</h2></div>
 
  <script>
  // Denne query kører op imod API'en som findes i 'main.js'.
  // Denne HTML skal derfor åbnes igennem serveren for at virke.
  d3.json("/test", {
    method: "POST", 
  }).then(function(response) {
    const w = 500;
    const h = 350;
    const margin = 20; 
    const data = response.data; // Hent data ud af response
    let columns = ["Landbrug","Energi","industi og ervherv","transport","husholdning", "Samlet udledning"]
   
    let timeParse =  d3.utcParse("%Y-%m-%dT%H:%M:%S.%LZ")
    console.log("data", data);
  
  /*
      for (let i = 0; i < data.length; i++){
         console.log((dateParse(data[i].dato)))
      }
   */ 
   //defining scales, used later for when we want to add axes 

   let xScale = d3.scaleTime()
              .domain([ 
                d3.min(data, function (d){return timeParse(d.dato);}),
                d3.max(data, function (d){return timeParse(d.dato);})
              ])
              .range([margin, w-margin ])
    let yScale = d3.scaleLinear()
              .domain([
                d3.min(data, function (d){return (d.nettoudledning);}),
                d3.max(data, function (d){return (d.nettoudledning);})
              ])
              .range([margin, h-margin ])
  //defines axes 
  let xAxis = d3.axisBottom()
                .scale(xScale)
  let yAxis = d3.axisLeft()
                .scale(yScale)
         //lav dropdown menu ud fra html element
  d3.select("#dropdown")
    .selectAll('myOptions')
    .data(columns)
    .enter()
    .append('option')
    .text(function(d){return d})
    .attr("value",function(d){return d})
//place svg inside the div called side
d3.selectAll(".side")
.append("svg")
let svg = d3.selectAll("svg")
.attr("height", h)
.attr("width",w)

svg.append("g")
.attr("transform", "translate(0," + (h-margin) + ")")
.call(xAxis)


svg.append("g")

.attr("transform", "translate(20,0)")

      .call(yAxis)
 

//creates the line for the graph

svg
.append("g")
.append("path")
.data(data)
.attr("d",  d3.svg.line()
.x(function(d){ return xScale(timeParse(+d.dato)) })
.y(function(d) { return yScale(+d.nettoudledning ) })
)
.attr("stroke","pink")
.attr("stroke-width", 4)
.attr("fill","black")
  });
  //test comment 
  </script>
</body>
</html>